{
    "collab_server" : "",
    "contents" : "#' Function to load RACE bottom trawl data. \n#' Catch and haul data are merged with species names, and zeros are added for missing no-catch observations.\n#'\n#' @param species.codes vector of species codes for which data will be returned\n#' @param area string indicating the area of focus: GOA, BS, AI\n#' @param writeCSV boolean indicating whether \"output/RACE_data_output.csv\" is created\n#' @param writeDATA boolean indicating whether \"output/RACE_data_output.RData\" is created\n#'\n#' @return A data frame of RACE bottom trawl data, with rows equal to species-by-haul observations\n#' @export\nload_RACE_data <- function(species.codes=c(30152,30420), area=\"GOA\", writeCSV=FALSE, writeDATA=FALSE) {\n  # require(FishData)\n\n  \n  #FOR ORIGINAL .CSV INPUT\n  # #Opening section to determine suitability\n  # if(file.exists(\"data/race_base_haul.csv\")==FALSE) { stop(\"data/race_base_haul.csv NOT FOUND\") }\n  # if(file.exists(\"data/race_base_catch.csv\")==FALSE) { stop(\"data/race_base_catch.csv NOT FOUND\") }\n  # if(file.exists(\"data/race_species_codes.csv\")==FALSE) { stop(\"data/race_species_codes.csv NOT FOUND\") }\n  # \n  # #Load catch and haul data\n  # haul <- read.csv(\"data/race_base_haul.csv\", header=TRUE, stringsAsFactors=FALSE)\n  # catch <- read.csv(\"data/race_base_catch.csv\", header=TRUE, stringsAsFactors=FALSE)\n  \n  #FOR NEW .RData INPUT\n  #Opening section to determine suitability\n  if(file.exists(\"data/race_base_haul.RData\")==FALSE) { stop(\"data/race_base_haul.RData NOT FOUND\") }\n  if(file.exists(\"data/race_base_catch.RData\")==FALSE) { stop(\"data/race_base_catch.RData NOT FOUND\") }\n  if(file.exists(\"data/race_species_codes.csv\")==FALSE) { stop(\"data/race_species_codes.csv NOT FOUND\") }\n  if(file.exists(\"data/race_cruise_info.csv\")==FALSE) { stop(\"data/race_cruise_info.csv NOT FOUND\") }\n  \n  #Load catch and haul data\n  load(\"data/race_base_catch.RData\")\n  load(\"data/race_base_haul.RData\")\n\n  \n  #Merge data\n  catchhaul <- merge(x=catch, y=haul, all.y=TRUE, all.x=FALSE, by.x=\"HAULJOIN\", by.y=\"HAULJOIN\")\n  \n  #Add in zero observations for catch weight, for no catches.\n  #  Drawing on Jim Thorson's code from FishData\n  catchhaul.2 <- FishData::add_missing_zeros(data_frame=catchhaul, unique_sample_ID_colname=\"HAULJOIN\",\n                                               sample_colname=\"WEIGHT\", species_colname=\"SPECIES_CODE\",\n                                               species_subset=species.codes,\n                                               if_multiple_records=\"First\",\n                                                Method=\"Fast\")\n  #Limit to specific area\n  catchhaul.2 <- catchhaul.2[catchhaul.2$REGION.x==area,]\n  \n  #Calculate and add Effort and CPUE\n  catchhaul.2$effort <- catchhaul.2$NET_WIDTH*catchhaul.2$DISTANCE_FISHED/1000\n  catchhaul.2$cpue <- catchhaul.2$WEIGHT/catchhaul.2$effort\n  \n  #Add species name\n  species.code.data <- read.csv(\"data/race_species_codes.csv\", header=TRUE, stringsAsFactors=FALSE)\n  catchhaul.3 <- merge(x=catchhaul.2, y=species.code.data[,c(\"Species.Code\",\"Common.Name\")], \n                       by.x=\"SPECIES_CODE\", by.y=\"Species.Code\")\n  \n  #Add year of survey\n  cruise.info <- read.csv(\"data/race_cruise_info.csv\", header=TRUE, stringsAsFactors=FALSE)\n  output <- merge(x=catchhaul.3, y=cruise.info[,c(\"Cruise.Join.ID\",\"Year\")], \n                       by.x=\"CRUISEJOIN.x\", by.y=\"Cruise.Join.ID\")\n  \n  #Return Section\n  if(writeCSV==TRUE) { write.csv(output, file=\"output/RACE_data_output.csv\") }\n  if(writeDATA==TRUE) { save(output, file=\"output/RACE_data_output.RData\") }\n  \n  return(output)\n}",
    "created" : 1490723505874.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4124133419",
    "id" : "DCE68487",
    "lastKnownWriteTime" : 1490742143,
    "last_content_update" : 1490830780622,
    "path" : "~/Projects/VAST Evaluation/AFSC_VAST_Evaluation/R/load-RACE-data.r",
    "project_path" : "R/load-RACE-data.r",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 3,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}